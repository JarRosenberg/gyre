# File     : test_support
# Purpose  : support for GYRE test scripts

# Get the platform architecture

get_arch ()
{

    local hardware=`uname -m`
    local os=`uname -s`

    echo -n "${hardware}-${os}"

}

# Run GYRE

run_gyre ()
{

    local exec=$1
    local file=$2
    local label=$3

    echo -n "TEST $label"

    $exec $file > /dev/null
    retval=$?

    if [ $retval -ne 0 ]; then
	echo " ...failed during execution of $exec"
    fi

    return $retval

}

# Check output

check_output ()
{

    local file=$1
    local relerr=$2
    local fields=$3

    local arch=$(get_arch)

    ref_file="ref/${file}.${arch}"

    if [ ! -e $ref_file ]; then
	ref_file="ref/${file}"
    fi

    ndiff -quiet -relerr $relerr -fields $fields $file $ref_file
    retval=$?

    if [ $retval -ne 0 ]; then
	echo " ...failed when comparing $file and $ref_file"
    fi

    return $retval

}
